generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model InterviewSession {
  id                  String                @id @default(uuid())
  createdAt           DateTime              @default(now())
  endedAt             DateTime?
  role                String
  level               String
  interviewType       String
  language            String
  durationMinutes     Int?
  status              String                @default("running")
  recruiterImpression String?
  overallScore        Int?
  technicalScore      Int?
  communicationScore  Int?
  problemSolvingScore Int?
  experienceScore     Int?
  evaluations         InterviewEvaluation[]
  finalReport         InterviewFinalReport?
  messages            InterviewMessage[]

  @@map("interview_sessions")
}

model InterviewMessage {
  id             String           @id @default(uuid())
  sessionId      String
  role           String
  text           String
  timestampMs    BigInt
  elapsedSec     Int
  recruiterMsgId String?
  createdAt      DateTime         @default(now())
  session        InterviewSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@index([sessionId])
  @@map("interview_messages")
}

model InterviewEvaluation {
  id                  String           @id @default(uuid())
  sessionId           String
  turnIndex           Int
  overallScore        Int
  technicalScore      Int
  communicationScore  Int
  problemSolvingScore Int
  experienceScore     Int
  signals             Json?
  notesPrivate        Json?
  createdAt           DateTime         @default(now())
  session             InterviewSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@index([sessionId])
  @@map("interview_evaluations")
}

model InterviewFinalReport {
  sessionId           String           @id
  impression          String
  overallScore        Int
  technicalScore      Int
  communicationScore  Int
  problemSolvingScore Int
  experienceScore     Int
  whatIDidWell        Json
  areasForImprovement Json
  rawModelOutput      String
  createdAt           DateTime         @default(now())
  session             InterviewSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@map("interview_final_reports")
}
